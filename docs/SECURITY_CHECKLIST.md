# æ™ºèƒ½åˆçº¦å®‰å…¨æ£€æŸ¥æ¸…å•

## ğŸ” å®¡è®¡å‰å‡†å¤‡

### ç¯å¢ƒå‡†å¤‡
- [ ] å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„å®¡è®¡å·¥å…·
- [ ] ç¡®ä¿Slitherå’ŒFoundryæ­£ç¡®é…ç½®
- [ ] å‡†å¤‡å¥½åˆçº¦æºä»£ç å’Œä¾èµ–
- [ ] äº†è§£åˆçº¦çš„ä¸šåŠ¡é€»è¾‘å’Œé¢„æœŸè¡Œä¸º

### æ–‡æ¡£å‡†å¤‡
- [ ] è·å–åˆçº¦ç™½çš®ä¹¦æˆ–æŠ€æœ¯æ–‡æ¡£
- [ ] äº†è§£åˆçº¦çš„éƒ¨ç½²ç¯å¢ƒå’Œç½‘ç»œ
- [ ] ç¡®è®¤åˆçº¦æ¶‰åŠçš„èµ„é‡‘è§„æ¨¡
- [ ] äº†è§£ç”¨æˆ·ç¾¤ä½“å’Œä½¿ç”¨åœºæ™¯

---

## ğŸ›¡ï¸ æ ¸å¿ƒå®‰å…¨æ£€æŸ¥

### 1. é‡å…¥æ”»å‡» (Reentrancy) âš ï¸ Critical

**æ£€æŸ¥é¡¹ï¼š**
- [ ] æ‰€æœ‰å¤–éƒ¨è°ƒç”¨æ˜¯å¦åœ¨çŠ¶æ€æ›´æ–°åæ‰§è¡Œï¼Ÿ
- [ ] æ˜¯å¦ä½¿ç”¨äº†ReentrancyGuardä¿®é¥°å™¨ï¼Ÿ
- [ ] æ£€æŸ¥æ‰€æœ‰`.call()`ã€`.delegatecall()`ã€`.staticcall()`è°ƒç”¨
- [ ] æ£€æŸ¥`.transfer()`å’Œ`.send()`çš„ä½¿ç”¨ï¼ˆè™½ç„¶å®ƒä»¬æœ‰gasé™åˆ¶ï¼‰
- [ ] æ˜¯å¦éµå¾ªChecks-Effects-Interactionsæ¨¡å¼ï¼Ÿ

**å¸¸è§æ¼æ´æ¨¡å¼ï¼š**
```solidity
// âŒ æ˜“å—æ”»å‡»
function withdraw() public {
    (bool success, ) = msg.sender.call{value: balance}("");
    require(success);
    balance = 0;  // çŠ¶æ€æ›´æ–°å¤ªæ™š
}
```

**ä¿®å¤æ–¹æ¡ˆï¼š**
```solidity
// âœ… å®‰å…¨
function withdraw() public nonReentrant {
    uint256 amount = balance;
    balance = 0;  // å…ˆæ›´æ–°çŠ¶æ€
    (bool success, ) = msg.sender.call{value: amount}("");
    require(success);
}
```

---

### 2. æ•´æ•°æº¢å‡º/ä¸‹æº¢ âš ï¸ High

**æ£€æŸ¥é¡¹ï¼š**
- [ ] Solidityç‰ˆæœ¬æ˜¯å¦ä¸º0.8.0+ï¼Ÿ
- [ ] å¦‚æœç‰ˆæœ¬<0.8.0ï¼Œæ˜¯å¦ä½¿ç”¨äº†SafeMathï¼Ÿ
- [ ] æ£€æŸ¥æ‰€æœ‰ç®—æœ¯æ“ä½œï¼ˆ+, -, *, /, %ï¼‰
- [ ] æ£€æŸ¥æ•°ç»„ç´¢å¼•æ“ä½œ
- [ ] éªŒè¯å¾ªç¯è®¡æ•°å™¨ä¸ä¼šæº¢å‡º

**å¸¸è§æ¼æ´æ¨¡å¼ï¼š**
```solidity
// âŒ Solidity 0.7.x æ²¡æœ‰æº¢å‡ºæ£€æŸ¥
function add(uint256 a, uint256 b) public pure returns (uint256) {
    return a + b;  // å¯èƒ½æº¢å‡º
}
```

**ä¿®å¤æ–¹æ¡ˆï¼š**
```solidity
// âœ… æ–¹æ¡ˆ1: å‡çº§åˆ°Solidity 0.8+
pragma solidity ^0.8.19;

// âœ… æ–¹æ¡ˆ2: ä½¿ç”¨SafeMath (æ—§ç‰ˆæœ¬)
using SafeMath for uint256;
function add(uint256 a, uint256 b) public pure returns (uint256) {
    return a.add(b);
}
```

---

### 3. è®¿é—®æ§åˆ¶ âš ï¸ High

**æ£€æŸ¥é¡¹ï¼š**
- [ ] æ‰€æœ‰æ•æ„Ÿå‡½æ•°æ˜¯å¦æœ‰æƒé™ä¿®é¥°å™¨ï¼Ÿ
- [ ] æ˜¯å¦ä½¿ç”¨tx.originè¿›è¡Œèº«ä»½éªŒè¯ï¼Ÿï¼ˆå±é™©ï¼ï¼‰
- [ ] æ£€æŸ¥æ‰€æœ‰public/externalå‡½æ•°çš„æƒé™
- [ ] éªŒè¯ownerå’Œç®¡ç†å‘˜è§’è‰²çš„è®¾ç½®
- [ ] æ£€æŸ¥æƒé™è½¬ç§»å‡½æ•°çš„å®‰å…¨æ€§

**å¸¸è§æ¼æ´æ¨¡å¼ï¼š**
```solidity
// âŒ ä½¿ç”¨tx.origin
function transfer(address to, uint256 amount) public {
    require(tx.origin == owner);  // æ˜“å—é’“é±¼æ”»å‡»
    // ...
}

// âŒ ç¼ºå¤±æƒé™æ£€æŸ¥
function mint(address to, uint256 amount) public {
    balances[to] += amount;  // ä»»ä½•äººéƒ½å¯ä»¥mintï¼
}
```

**ä¿®å¤æ–¹æ¡ˆï¼š**
```solidity
// âœ… æ­£ç¡®å®ç°
import "@openzeppelin/contracts/access/Ownable.sol";

contract MyContract is Ownable {
    function mint(address to, uint256 amount) public onlyOwner {
        balances[to] += amount;
    }
}
```

---

### 4. å¤–éƒ¨è°ƒç”¨å®‰å…¨ âš ï¸ High

**æ£€æŸ¥é¡¹ï¼š**
- [ ] æ˜¯å¦éªŒè¯å¤–éƒ¨åˆçº¦åœ°å€ï¼Ÿ
- [ ] æ˜¯å¦å¤„ç†è°ƒç”¨å¤±è´¥çš„æƒ…å†µï¼Ÿ
- [ ] æ˜¯å¦é™åˆ¶gasä½¿ç”¨ï¼Ÿ
- [ ] æ£€æŸ¥é‡å…¥æ”»å‡»å¯èƒ½æ€§
- [ ] æ˜¯å¦æ£€æŸ¥è¿”å›å€¼ï¼Ÿ

**æœ€ä½³å®è·µï¼š**
```solidity
// âœ… å®‰å…¨çš„å¤–éƒ¨è°ƒç”¨
function safeCall(address target, bytes memory data) internal {
    require(target != address(0), "Invalid target");
    (bool success, bytes memory returnData) = target.call{gas: 100000}(data);
    require(success, "Call failed");
}
```

---

### 5. ä»·æ ¼æ“æ§ âš ï¸ High

**æ£€æŸ¥é¡¹ï¼š**
- [ ] æ˜¯å¦ä¾èµ–DEXä»·æ ¼ä½œä¸ºå”¯ä¸€ä»·æ ¼æºï¼Ÿ
- [ ] æ˜¯å¦ä½¿ç”¨TWAPï¼ˆæ—¶é—´åŠ æƒå¹³å‡ä»·æ ¼ï¼‰ï¼Ÿ
- [ ] æ£€æŸ¥é—ªç”µè´·æ”»å‡»å¯èƒ½æ€§
- [ ] éªŒè¯é¢„è¨€æœºçš„å¯ä¿¡åº¦

---

### 6. å‰äº¤æ˜“æ”»å‡» (Front-Running) âš ï¸ Medium

**æ£€æŸ¥é¡¹ï¼š**
- [ ] äº¤æ˜“é¡ºåºæ˜¯å¦å½±å“ç»“æœï¼Ÿ
- [ ] æ˜¯å¦å­˜åœ¨å¯é¢„æµ‹çš„å¥—åˆ©æœºä¼šï¼Ÿ
- [ ] æ˜¯å¦ä½¿ç”¨commit-revealæ–¹æ¡ˆï¼Ÿ
- [ ] æ£€æŸ¥MEVæ”»å‡»å¯èƒ½æ€§

---

### 7. æ‹’ç»æœåŠ¡ (DoS) âš ï¸ Medium

**æ£€æŸ¥é¡¹ï¼š**
- [ ] å¾ªç¯æ˜¯å¦æœ‰åˆç†çš„ä¸Šé™ï¼Ÿ
- [ ] å¤–éƒ¨è°ƒç”¨æ˜¯å¦ä¼šé˜»å¡æ•´ä¸ªåˆçº¦ï¼Ÿ
- [ ] æ˜¯å¦å¤„ç†å¼‚å¸¸æƒ…å†µï¼Ÿ
- [ ] æ£€æŸ¥gasæ¶ˆè€—æ˜¯å¦åˆç†

---

### 8. é€»è¾‘é”™è¯¯ âš ï¸ Medium

**æ£€æŸ¥é¡¹ï¼š**
- [ ] ä¸šåŠ¡é€»è¾‘æ˜¯å¦æ­£ç¡®å®ç°ï¼Ÿ
- [ ] æ¡ä»¶åˆ¤æ–­æ˜¯å¦å®Œæ•´ï¼Ÿ
- [ ] è¾¹ç•Œæƒ…å†µæ˜¯å¦å¤„ç†ï¼Ÿ
- [ ] çŠ¶æ€è½¬æ¢æ˜¯å¦æ­£ç¡®ï¼Ÿ

---

### 9. ä¿¡æ¯æ³„éœ² âš ï¸ Low

**æ£€æŸ¥é¡¹ï¼š**
- [ ] æ•æ„Ÿæ•°æ®æ˜¯å¦å…¬å¼€ï¼Ÿ
- [ ] é“¾ä¸Šå­˜å‚¨æ˜¯å¦åˆé€‚ï¼Ÿ
- [ ] æ—¥å¿—äº‹ä»¶æ˜¯å¦æ³„éœ²éšç§ï¼Ÿ

---

### 10. Gasä¼˜åŒ– âš ï¸ Low

**æ£€æŸ¥é¡¹ï¼š**
- [ ] æ˜¯å¦ä½¿ç”¨memoryä»£æ›¿storageï¼Ÿ
- [ ] å¾ªç¯æ˜¯å¦ä¼˜åŒ–ï¼Ÿ
- [ ] æ˜¯å¦æœ‰å†—ä½™çš„çŠ¶æ€è¯»å–ï¼Ÿ
- [ ] æ˜¯å¦ä½¿ç”¨uint256ï¼ˆå…¶ä»–ç±»å‹å¯èƒ½æ›´è€—gasï¼‰ï¼Ÿ

---

## ğŸ”¬ Foundryæµ‹è¯•æ£€æŸ¥

### æµ‹è¯•è¦†ç›–ç‡
- [ ] è¡Œè¦†ç›–ç‡ > 95%
- [ ] åˆ†æ”¯è¦†ç›–ç‡ > 90%
- [ ] å‡½æ•°è¦†ç›–ç‡ = 100%

### æµ‹è¯•ç±»å‹
- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•
- [ ] è¾¹ç•Œæµ‹è¯•
- [ ] å¤±è´¥æµ‹è¯•

### Foundryå‘½ä»¤
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
forge test

# æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡
forge coverage

# è¿è¡Œæ¨¡ç³Šæµ‹è¯•
forge test --fuzz-runs 1000

# GasæŠ¥å‘Š
forge test --gas-report
```

---

## ğŸ“Š Slitheræ£€æŸ¥

### è¿è¡ŒSlither
```bash
# åŸºæœ¬åˆ†æ
slither .

# è¾“å‡ºJSONæŠ¥å‘Š
slither . --json output.json

# è‡ªå®šä¹‰æ£€æµ‹å™¨
slither . --detect reentrancy-eth

# æ’é™¤ç‰¹å®šæ£€æµ‹å™¨
slither . --exclude-informational
```

### å…³é”®æ£€æµ‹å™¨
- `reentrancy-eth` - ä»¥å¤ªåŠé‡å…¥æ”»å‡»
- `reentrancy-no-eth` - éä»¥å¤ªåŠé‡å…¥æ”»å‡»
- `arbitrary-send` - ä»»æ„å‘é€ä»¥å¤ªå¸
- `controlled-delegatecall` - å—æ§çš„å§”æ‰˜è°ƒç”¨
- `suicidal` - åˆçº¦è‡ªæ¯é£é™©

---

## ğŸ“‹ å®¡è®¡æŠ¥å‘Šæ¸…å•

### æŠ¥å‘Šå†…å®¹
- [ ] æ‰§è¡Œæ‘˜è¦
- [ ] å®¡è®¡èŒƒå›´å’Œæ–¹æ³•
- [ ] å‘ç°çš„é—®é¢˜åˆ—è¡¨
- [ ] ä¸¥é‡ç¨‹åº¦åˆ†çº§
- [ ] ä¿®å¤å»ºè®®
- [ ] ä»£ç æ”¹è¿›å»ºè®®
- [ ] é™„å½•

### é—®é¢˜åˆ†çº§æ ‡å‡†

#### ğŸ”´ Critical (ä¸¥é‡)
- å¯ç›´æ¥å¯¼è‡´èµ„é‡‘æŸå¤±
- åˆçº¦é€»è¾‘å®Œå…¨å¤±æ•ˆ
- ç§é’¥æ³„éœ²é£é™©

#### ğŸŸ  High (é«˜å±)
- å¯èƒ½å¯¼è‡´èµ„é‡‘æŸå¤±
- ç»•è¿‡æƒé™æ§åˆ¶
- é‡å¤§é€»è¾‘é”™è¯¯

#### ğŸŸ¡ Medium (ä¸­å±)
- æ½œåœ¨çš„èµ„é‡‘é£é™©
- å¯èƒ½çš„é€»è¾‘é”™è¯¯
- éœ€è¦ç‰¹å®šæ¡ä»¶è§¦å‘

#### ğŸŸ¢ Low (ä½å±)
- ä»£ç è´¨é‡é—®é¢˜
- Gasä¼˜åŒ–å»ºè®®
- æœ€ä½³å®è·µå»ºè®®

---

## ğŸ¯ éƒ¨ç½²å‰æœ€ç»ˆæ£€æŸ¥

### ä»£ç å®¡æŸ¥
- [ ] ä»£ç å·²å……åˆ†æµ‹è¯•
- [ ] æ‰€æœ‰é«˜å±é—®é¢˜å·²ä¿®å¤
- [ ] ä»£ç ç»è¿‡åŒè¡Œå®¡æŸ¥
- [ ] ç¬¬ä¸‰æ–¹å®¡è®¡ï¼ˆå¦‚éœ€è¦ï¼‰

### éƒ¨ç½²å‡†å¤‡
- [ ] éƒ¨ç½²è„šæœ¬å·²æµ‹è¯•
- [ ] ç®¡ç†å‘˜å¯†é’¥å®‰å…¨å­˜å‚¨
- [ ] å‡çº§æœºåˆ¶å·²æµ‹è¯•
- [ ] ç´§æ€¥æš‚åœæœºåˆ¶å·²æµ‹è¯•

### ç›‘æ§å‡†å¤‡
- [ ] è®¾ç½®é“¾ä¸Šç›‘æ§
- [ ] å‡†å¤‡åº”æ€¥å“åº”è®¡åˆ’
- [ ] å»ºç«‹äº‹ä»¶é€šçŸ¥æœºåˆ¶

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [OpenZeppelin Contracts](https://docs.openzeppelin.com/)
- [Slither Documentation](https://github.com/crytic/slither)
- [Foundry Book](https://book.getfoundry.sh/)
- [SWC Registry](https://swcregistry.io/)
- [Smart Contract Security Best Practices](https://consensys.github.io/smart-contract-best-practices/)

---

**ğŸ’¡ æç¤ºï¼š** æ­¤æ£€æŸ¥æ¸…å•åº”ç»“åˆé¡¹ç›®å®é™…æƒ…å†µä½¿ç”¨ï¼Œå¹¶æ ¹æ®éœ€æ±‚æ·»åŠ ç‰¹å®šæ£€æŸ¥é¡¹ã€‚
